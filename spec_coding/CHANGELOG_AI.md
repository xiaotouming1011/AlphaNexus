# AI 协作开发记录（CHANGELOG_AI）

> 目的：记录“我们如何把 AlphaNexus 从原始状态一步步推进到当前版本”，方便后续 AI 快速接力。

## Phase 0 - 项目边界确定
- 确认以 `/Users/anji/TradingAgents_副本` 作为实际开发目录。
- 明确目标：CLI 保留，重点增强 Web 端可用性与可解释性。

## Phase 1 - 基础可运行与中文化
- 梳理项目结构与依赖，确保 FastAPI 可启动。
- 统一品牌命名为 `AlphaNexus`。
- 优化提示词：正文尽量中文，保留必要英文标签/术语。

## Phase 2 - Web 研究页核心增强
- 增加供应商/API Key 输入并透传后端。
- 增加模型下拉选择，避免用户手输 model id。
- 增加 SSE 流式输出。
- 输出支持 Markdown 渲染与下载。
- 来源展示从“长 URL”改为“时间 + 来源站点 + 跳转链接”。

## Phase 3 - 数据源与稳定性
- 接入 Alpha Vantage 相关能力。
- 处理 rate limit / timeout / SSL 等错误路径。
- 实施串行请求与缓存回退策略，提高可用性。

## Phase 4 - Portfolio 子页面
- 新增 `/portfolio` 子页面与图表展示。
- 支持组合价值与权重可视化。
- 与主页面形成统一入口切换。

## Phase 5 - 前端视觉重构
- 重做研究页样式与信息分区。
- 保持移动端可用与响应式布局。

## Phase 6 - 公司关系图谱能力
- 新增本地图谱模块（JSON-backed graph store）。
- 新增图谱工具并接入分析师流程。
- 新增图谱 API 与前端展示模块。
- 支持跨公司影响链（供应链/合作/竞争/持股）。

## Phase 7 - 辩论显示缺陷修复（关键）
- 通过浏览器 MCP 复现：辩论过程生成了，但前端没显示。
- 根因定位：
  - 后端 final payload 未包含 debate states；
  - SSE 未推送 debate 类型事件；
  - 前端缺少辩论面板。
- 修复内容：
  - 后端新增 debate payload；
  - SSE 新增 `type=debate`；
  - 前端新增投资辩论/风控辩论两块展示。

---

## 当前版本能力结论（截至本记录）
1. 研究页：可流式、可追来源、可下载、可见辩论过程。
2. 组合页：可视化可运行，并具备缓存回退。
3. 图谱：可用于跨公司影响推理并在前端展示。

---

## 后续建议（下一轮）
1. 辩论面板升级为按轮次折叠展示。
2. 结论与证据建立严格映射（claim -> source id）。
3. 图谱数据治理（来源、更新日期、置信度标准化）。

